(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1792],{9576:function(e,t,s){Promise.resolve().then(s.bind(s,5511))},5511:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});var a=s(9692),r=s(9693),l=s(2727);function n(){let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[c,d]=(0,r.useState)("all"),[u,m]=(0,r.useState)("all"),[x,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)({email:"",firstName:"",lastName:"",role:"student",status:"active"});(0,r.useEffect)(()=>{(async()=>{try{console.log("\uD83D\uDD0D DEBUG: Fetching users from API and localStorage...");let e=await fetch("/api/admin/users",{method:"GET",headers:{"Content-Type":"application/json"}}),s=[];e.ok?(s=(await e.json()).users||[],console.log("\uD83D\uDD0D DEBUG: Successfully fetched default users:",s.length)):console.error("\uD83D\uDD0D DEBUG: Failed to fetch default users, using empty array");let a=[];try{let e=localStorage.getItem("demo-users");e&&(a=JSON.parse(e),console.log("\uD83D\uDD0D DEBUG: Found user-created users in localStorage:",a.length))}catch(e){console.error("\uD83D\uDD0D DEBUG: Error reading from localStorage:",e)}let r=[...s,...a];console.log("\uD83D\uDD0D DEBUG: Total users (default + user-created):",r.length),t(r)}catch(e){console.error("Error fetching users:",e);try{let e=localStorage.getItem("demo-users");if(e){let s=JSON.parse(e);console.log("\uD83D\uDD0D DEBUG: Fallback: loaded users from localStorage only:",s.length),t(s)}else t([])}catch(e){console.error("\uD83D\uDD0D DEBUG: Fallback also failed:",e),t([])}}finally{n(!1)}})()},[]);let f=e.filter(e=>{let t=e.email.toLowerCase().includes(i.toLowerCase())||e.firstName.toLowerCase().includes(i.toLowerCase())||e.lastName.toLowerCase().includes(i.toLowerCase()),s="all"===c||e.role===c,a="all"===u||e.status===u;return t&&s&&a}),D=e=>{switch(e){case"admin":return"bg-red-100 text-red-800";case"staff":return"bg-blue-100 text-blue-800";case"student":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},y=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":default:return"bg-gray-100 text-gray-800";case"pending":return"bg-yellow-100 text-yellow-800"}},j=async s=>{try{console.log("\uD83D\uDD0D DEBUG: User creation attempted with data:",s);let a=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();if(!a.ok)throw Error(r.error||"Failed to create user");console.log("\uD83D\uDD0D DEBUG: User created successfully:",r.user);try{let e=[...JSON.parse(localStorage.getItem("demo-users")||"[]"),r.user];localStorage.setItem("demo-users",JSON.stringify(e)),console.log("\uD83D\uDD0D DEBUG: User saved to localStorage, total users:",e.length)}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving to localStorage:",e)}let l=[...e,r.user];return t(l),alert("User created successfully!"),r.user}catch(e){throw console.error("Error creating user:",e),alert("Failed to create user: ".concat(e instanceof Error?e.message:"Unknown error")),e}},N=async s=>{try{console.log("\uD83D\uDD0D DEBUG: User update attempted with data:",s);let a=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();if(!a.ok)throw Error(r.error||"Failed to update user");console.log("\uD83D\uDD0D DEBUG: User updated successfully:",r.user);try{let t=e.map(e=>e.id===s.id?r.user:e).filter(e=>!["1","2"].includes(e.id));localStorage.setItem("demo-users",JSON.stringify(t)),console.log("\uD83D\uDD0D DEBUG: User update saved to localStorage")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving user update to localStorage:",e)}let l=e.map(e=>e.id===s.id?r.user:e);return t(l),alert("User updated successfully!"),r.user}catch(e){throw console.error("Error updating user:",e),alert("Failed to update user: ".concat(e instanceof Error?e.message:"Unknown error")),e}},b=async s=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{console.log("\uD83D\uDD0D DEBUG: User deletion attempted for ID:",s);let a=await fetch("/api/admin/users?id=".concat(s),{method:"DELETE",headers:{"Content-Type":"application/json"}}),r=await a.json();if(!a.ok)throw Error(r.error||"Failed to delete user");console.log("\uD83D\uDD0D DEBUG: User deleted successfully:",s);try{let t=e.filter(e=>e.id!==s).filter(e=>!["1","2"].includes(e.id));localStorage.setItem("demo-users",JSON.stringify(t)),console.log("\uD83D\uDD0D DEBUG: User deletion saved to localStorage")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving user deletion to localStorage:",e)}let l=e.filter(e=>e.id!==s);t(l),alert("User deleted successfully!")}catch(e){console.error("Error deleting user:",e),alert("Failed to delete user: ".concat(e instanceof Error?e.message:"Unknown error"))}},v=async e=>{e.preventDefault();try{await j(g),p({email:"",firstName:"",lastName:"",role:"student",status:"active"}),h(!1)}catch(e){}};return s?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage all users in the system"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:()=>h(!0),className:"btn-primary",children:"Create New User"}),(0,a.jsx)(l.default,{href:"/admin/users/invitations",className:"btn-secondary",children:"Send Invitations"})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Users"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:i,onChange:e=>o(e.target.value),className:"input-field"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Role"}),(0,a.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"input-field",children:[(0,a.jsx)("option",{value:"all",children:"All Roles"}),(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"staff",children:"Staff"}),(0,a.jsx)("option",{value:"student",children:"Student"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),(0,a.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"input-field",children:[(0,a.jsx)("option",{value:"all",children:"All Status"}),(0,a.jsx)("option",{value:"active",children:"Active"}),(0,a.jsx)("option",{value:"inactive",children:"Inactive"}),(0,a.jsx)("option",{value:"pending",children:"Pending"})]})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["All Users (",f.length,")"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Login"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-sm font-medium text-blue-600",children:[e.firstName.charAt(0),e.lastName.charAt(0)]})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(D(e.role)),children:e.role})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(y(e.status)),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.lastLogin}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{console.log("DEBUG: Edit user button clicked for user:",e.id);let t=prompt("Enter new first name:",e.firstName),s=prompt("Enter new last name:",e.lastName);t&&s&&N({...e,firstName:t,lastName:s})},className:"text-blue-600 hover:text-blue-900",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>b(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"}),(0,a.jsx)("button",{onClick:()=>{console.log("DEBUG: View details button clicked for user:",e.id),window.location.href="/admin/users/".concat(e.id)},className:"text-green-600 hover:text-green-900",children:"View Details"})]})})]},e.id))})]})})]}),x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New User"}),(0,a.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",required:!0,value:g.email,onChange:e=>p(t=>({...t,email:e.target.value})),className:"input-field",placeholder:"user@lpu.edu.ph or user@lpunetwork.edu.ph"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),(0,a.jsx)("input",{type:"text",required:!0,value:g.firstName,onChange:e=>p(t=>({...t,firstName:e.target.value})),className:"input-field",placeholder:"First Name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),(0,a.jsx)("input",{type:"text",required:!0,value:g.lastName,onChange:e=>p(t=>({...t,lastName:e.target.value})),className:"input-field",placeholder:"Last Name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,a.jsxs)("select",{value:g.role,onChange:e=>p(t=>({...t,role:e.target.value})),className:"input-field",children:[(0,a.jsx)("option",{value:"student",children:"Student"}),(0,a.jsx)("option",{value:"staff",children:"Staff"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,a.jsxs)("select",{value:g.status,onChange:e=>p(t=>({...t,status:e.target.value})),className:"input-field",children:[(0,a.jsx)("option",{value:"active",children:"Active"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"inactive",children:"Inactive"})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",className:"btn-primary flex-1",children:"Create User"}),(0,a.jsx)("button",{type:"button",onClick:()=>h(!1),className:"btn-secondary flex-1",children:"Cancel"})]})]})]})})]})}}},function(e){e.O(0,[2727,5248,5633,1744],function(){return e(e.s=9576)}),_N_E=e.O()}]);