(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8866],{2946:function(e,t,r){Promise.resolve().then(r.bind(r,2839))},2839:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var s=r(9692),l=r(9693);function a(){let[e,t]=(0,l.useState)([]),[r,a]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[d,c]=(0,l.useState)(!0),[o,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[g,p]=(0,l.useState)(""),[h,f]=(0,l.useState)(""),[b,y]=(0,l.useState)([]),[D,j]=(0,l.useState)({title:"",message:"",reminder_type:"general",priority:"medium",target_audience:"all_students",target_user_ids:[],target_course_ids:[],target_emails:[],is_dismissible:!0,expires_at:""});(0,l.useEffect)(()=>{_(),v()},[]);let v=()=>{let e=localStorage.getItem("demo-session");if(e)try{let t=JSON.parse(e);p(t.role||"")}catch(e){console.error("Error parsing demo session:",e)}},_=async()=>{try{c(!0),console.log("\uD83D\uDD0D DEBUG: Fetching reminders from API and localStorage...");let e=[],r=await fetch("/api/admin/reminders");r.ok?(e=(await r.json()).reminders||[],console.log("\uD83D\uDD0D DEBUG: Successfully fetched default reminders:",e.length)):console.error("\uD83D\uDD0D DEBUG: Failed to fetch default reminders, using empty array");let s=[];try{let e=localStorage.getItem("demo-reminders");e&&(s=JSON.parse(e),console.log("\uD83D\uDD0D DEBUG: Found user-created reminders in localStorage:",s.length))}catch(e){console.error("\uD83D\uDD0D DEBUG: Error reading reminders from localStorage:",e)}let l=[...e,...s];console.log("\uD83D\uDD0D DEBUG: Total reminders (default + user-created):",l.length),t(l);let i=await fetch("/api/admin/courses");if(i.ok){let e=await i.json();a(e.courses||[])}let d=await fetch("/api/admin/users");if(d.ok){let e=await d.json(),t=e.users||[];"staff"===g?t=t.filter(e=>"student"===e.role):"admin"===g&&(t=e.users||[]),n(t)}}catch(e){console.error("Error fetching reminders:",e);try{let e=localStorage.getItem("demo-reminders");if(e){let r=JSON.parse(e);console.log("\uD83D\uDD0D DEBUG: Fallback: loaded reminders from localStorage only:",r.length),t(r)}else t([])}catch(e){console.error("\uD83D\uDD0D DEBUG: Fallback also failed:",e),t([])}}finally{c(!1)}},N=async r=>{r.preventDefault();try{if(console.log("\uD83D\uDD0D DEBUG: Reminder save attempted with data:",D),m){let r={...m,...D,updated_at:new Date().toISOString()},s=e.map(e=>e.id===m.id?r:e);t(s);try{let e=s.filter(e=>!["default-reminder-1","default-reminder-2"].includes(e.id));localStorage.setItem("demo-reminders",JSON.stringify(e)),console.log("\uD83D\uDD0D DEBUG: Reminder edit saved to localStorage")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving reminder edit to localStorage:",e)}alert("Reminder updated successfully!")}else{let r={id:Date.now().toString(),...D,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_active:!0,created_by_user:{id:"current-user",first_name:"Current",last_name:"User",email:"current@user.com",role:g||"admin"}},s=[...e,r];t(s);try{let e=s.filter(e=>!["default-reminder-1","default-reminder-2"].includes(e.id));localStorage.setItem("demo-reminders",JSON.stringify(e)),console.log("\uD83D\uDD0D DEBUG: New reminder saved to localStorage")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving new reminder to localStorage:",e)}alert("Reminder created successfully!")}C(),u(!1),x(null)}catch(e){console.error("Error saving reminder:",e),alert("Error saving reminder")}},S=async r=>{if(confirm("Are you sure you want to delete this reminder?"))try{console.log("\uD83D\uDD0D DEBUG: Reminder deletion attempted for ID:",r);let s=e.filter(e=>e.id!==r);t(s);try{let e=s.filter(e=>!["default-reminder-1","default-reminder-2"].includes(e.id));localStorage.setItem("demo-reminders",JSON.stringify(e)),console.log("\uD83D\uDD0D DEBUG: Reminder deletion saved to localStorage")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving reminder deletion to localStorage:",e)}alert("Reminder deleted successfully!")}catch(e){console.error("Error deleting reminder:",e),alert("Error deleting reminder")}},w=e=>{x(e),j({title:e.title,message:e.message,reminder_type:e.reminder_type,priority:e.priority,target_audience:e.target_audience,target_user_ids:e.target_user_ids||[],target_course_ids:e.target_course_ids||[],target_emails:e.target_emails||[],is_dismissible:e.is_dismissible,expires_at:e.expires_at?new Date(e.expires_at).toISOString().slice(0,16):""}),y(e.target_emails||[]),u(!0)},C=()=>{j({title:"",message:"",reminder_type:"general",priority:"medium",target_audience:"all_students",target_user_ids:[],target_course_ids:[],target_emails:[],is_dismissible:!0,expires_at:""}),y([]),f("")},E=e=>{if(e&&!b.includes(e)){let t=[...b,e];y(t),j({...D,target_emails:t}),f("")}},k=e=>{let t=b.filter(t=>t!==e);y(t),j({...D,target_emails:t})},U=async r=>{try{console.log("\uD83D\uDD0D DEBUG: Toggling reminder status for ID:",r.id);let s={...r,is_active:!r.is_active,updated_at:new Date().toISOString()},l=e.map(e=>e.id===r.id?s:e);t(l);try{let e=l.filter(e=>!["default-reminder-1","default-reminder-2"].includes(e.id));localStorage.setItem("demo-reminders",JSON.stringify(e)),console.log("\uD83D\uDD0D DEBUG: Reminder status toggle saved to localStorage")}catch(e){console.error("\uD83D\uDD0D DEBUG: Error saving reminder status toggle to localStorage:",e)}}catch(e){console.error("Error toggling reminder status:",e)}},A=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},B=e=>{switch(e){case"announcement":return"\uD83D\uDCE2";case"deadline":return"⏰";case"maintenance":return"⚠️";case"course_update":return"\uD83D\uDCDA";case"assignment":return"\uD83D\uDCDD";case"exam":return"\uD83D\uDCCB";case"event":return"\uD83D\uDCC5";default:return"ℹ️"}};return d?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Reminder Management"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Create and manage reminders for students and staff."})]}),(0,s.jsx)("button",{onClick:()=>{C(),x(null),u(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium",children:"Create Reminder"})]})}),o&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:m?"Edit Reminder":"Create New Reminder"}),(0,s.jsx)("button",{onClick:()=>{u(!1),x(null),C()},className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),(0,s.jsx)("input",{type:"text",value:D.title,onChange:e=>j({...D,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),(0,s.jsx)("textarea",{value:D.message,onChange:e=>j({...D,message:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),(0,s.jsxs)("select",{value:D.reminder_type,onChange:e=>j({...D,reminder_type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"general",children:"General"}),(0,s.jsx)("option",{value:"announcement",children:"Announcement"}),(0,s.jsx)("option",{value:"deadline",children:"Deadline"}),(0,s.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,s.jsx)("option",{value:"course_update",children:"Course Update"}),(0,s.jsx)("option",{value:"assignment",children:"Assignment"}),(0,s.jsx)("option",{value:"exam",children:"Exam"}),(0,s.jsx)("option",{value:"event",children:"Event"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),(0,s.jsxs)("select",{value:D.priority,onChange:e=>j({...D,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"low",children:"Low"}),(0,s.jsx)("option",{value:"medium",children:"Medium"}),(0,s.jsx)("option",{value:"high",children:"High"}),(0,s.jsx)("option",{value:"urgent",children:"Urgent"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Audience"}),(0,s.jsx)("select",{value:D.target_audience,onChange:e=>j({...D,target_audience:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:("staff"===g?[{value:"all_students",label:"All Students"},{value:"specific_students",label:"Specific Students"},{value:"specific_emails",label:"Specific Email Addresses"},{value:"course_students",label:"Course Students"}]:[{value:"all_students",label:"All Students"},{value:"specific_students",label:"Specific Students"},{value:"specific_emails",label:"Specific Email Addresses"},{value:"course_students",label:"Course Students"},{value:"all_users",label:"All Users"},{value:"staff_only",label:"Staff Only"},{value:"admin_only",label:"Admin Only"}]).map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),"staff"===g&&(0,s.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"⚠️ Staff can only send reminders to students"})]}),"specific_students"===D.target_audience&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Students"}),(0,s.jsx)("select",{multiple:!0,value:D.target_user_ids,onChange:e=>j({...D,target_user_ids:Array.from(e.target.selectedOptions,e=>e.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-32",children:i.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name," (",e.email,")"]},e.id))}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple students"})]}),"specific_emails"===D.target_audience&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Addresses"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("input",{type:"email",value:h,onChange:e=>f(e.target.value),placeholder:"Enter email address...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),E(h))}}),(0,s.jsx)("button",{type:"button",onClick:()=>E(h),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add"})]}),b.length>0&&(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 max-h-32 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map((e,t)=>(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>k(e),className:"ml-1 text-blue-600 hover:text-blue-800",children:"\xd7"})]},t))})}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Enter email addresses one by one. Press Enter or click Add to include each email."})]})]}),"course_students"===D.target_audience&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Courses"}),(0,s.jsx)("select",{multiple:!0,value:D.target_course_ids,onChange:e=>j({...D,target_course_ids:Array.from(e.target.selectedOptions,e=>e.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-32",children:r.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.code," - ",e.title]},e.id))}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple courses"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expires At (Optional)"}),(0,s.jsx)("input",{type:"datetime-local",value:D.expires_at,onChange:e=>j({...D,expires_at:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"is_dismissible",checked:D.is_dismissible,onChange:e=>j({...D,is_dismissible:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("label",{htmlFor:"is_dismissible",className:"ml-2 block text-sm text-gray-700",children:"Allow users to dismiss this reminder"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{u(!1),x(null),C()},className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:[m?"Update":"Create"," Reminder"]})]})]})]})})}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"All Reminders"})}),(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reminder"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type & Priority"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Target Audience"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("span",{className:"text-lg",children:B(e.reminder_type)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,s.jsx)("div",{className:"text-sm text-gray-500 line-clamp-2",children:e.message})]})]})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:e.reminder_type.replace("_"," ").toUpperCase()}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(A(e.priority)),children:e.priority.toUpperCase()})]})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.target_audience.replace("_"," ").toUpperCase()}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("button",{onClick:()=>U(e),className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,s.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-500",children:[(0,s.jsx)("div",{children:new Date(e.created_at).toLocaleDateString()}),(0,s.jsxs)("div",{className:"text-xs",children:["by ",e.created_by_user.first_name," ",e.created_by_user.last_name]})]}),(0,s.jsxs)("td",{className:"px-6 py-4 text-sm font-medium space-x-2",children:[(0,s.jsx)("button",{onClick:()=>w(e),className:"text-blue-600 hover:text-blue-900",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>S(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id))})]}),0===e.length&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCE2"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No reminders yet"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Create your first reminder to get started."}),(0,s.jsx)("button",{onClick:()=>{C(),x(null),u(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium",children:"Create Reminder"})]})]})]})]})}}},function(e){e.O(0,[5248,5633,1744],function(){return e(e.s=2946)}),_N_E=e.O()}]);